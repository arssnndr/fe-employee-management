<div class="min-h-screen bg-gray-50">
  <!-- Header -->
  <app-header title="Employee Management" description="Kelola data karyawan perusahaan" [buttonConfig]="buttonConfig"
    (buttonClick)="logout()">
  </app-header>

  <!-- Main Content -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Search and Filters -->
    <div class="bg-white rounded-lg shadow p-6 mb-6">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
        <!-- Search Term -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">
            Cari Karyawan
          </label>
          <input #searchBox type="text" [(ngModel)]="searchParams.searchTerm" (input)="onSearchInput(searchBox.value)"
            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            placeholder="Nama, username, atau email..." />
        </div>

        <!-- Status Filter -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">
            Status
          </label>
          <select [(ngModel)]="searchParams.status" (change)="onSearch()"
            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
            <option value="">Semua Status</option>
            <option value="Active">Active</option>
            <option value="Inactive">Inactive</option>
            <option value="On Leave">On Leave</option>
            <option value="Probation">Probation</option>
          </select>
        </div>

        <!-- Group Filter -->
        <div class="relative">
          <label class="block text-sm font-medium text-gray-700 mb-2">
            Grup/Departemen
          </label>
          <app-group-autocomplete [(ngModel)]="searchParams.group" [items]="groups"
            placeholder="Pilih atau ketik grup..." (selected)="onSearch()"
            (cleared)="clearGroupFilter()"></app-group-autocomplete>
        </div>

        <!-- Page Size -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">
            Data per Halaman
          </label>
          <select [(ngModel)]="pagination.pageSize" (change)="onPageSizeChange()"
            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
            <option *ngFor="let size of pageSizeOptions" [value]="size">
              {{ size }} data
            </option>
          </select>
        </div>
      </div>

      <!-- Add Employee Button -->
      <div class="flex justify-between items-center">
        <div class="text-sm text-gray-600">
          Menampilkan {{ pagination.totalItems }} karyawan
        </div>
        <button (click)="addEmployee()"
          class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors flex items-center">
          <app-icon name="plus" class="w-4 h-4 mr-2" stroke="currentColor"></app-icon>
          Tambah Karyawan
        </button>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading">
      <app-loading-spinner message="Memuat data karyawan..."
        [containerClass]="'bg-white rounded-lg shadow p-8 text-center'"></app-loading-spinner>
    </div>

    <!-- Employee Table -->
    <div *ngIf="!isLoading" class="bg-white rounded-lg shadow overflow-hidden">
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider flex justify-center">
                No.
              </th>
              <th (click)="onSort('firstName')"
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100">
                <div class="flex items-center">
                  Nama
                  <span class="ml-1">{{ getSortIcon("firstName") }}</span>
                </div>
              </th>
              <th (click)="onSort('username')"
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100">
                <div class="flex items-center">
                  Username
                  <span class="ml-1">{{ getSortIcon("username") }}</span>
                </div>
              </th>
              <th (click)="onSort('email')"
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100">
                <div class="flex items-center">
                  Email
                  <span class="ml-1">{{ getSortIcon("email") }}</span>
                </div>
              </th>
              <th (click)="onSort('group')"
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100">
                <div class="flex items-center">
                  Grup
                  <span class="ml-1">{{ getSortIcon("group") }}</span>
                </div>
              </th>
              <th (click)="onSort('status')"
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100">
                <div class="flex items-center">
                  Status
                  <span class="ml-1">{{ getSortIcon("status") }}</span>
                </div>
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider flex justify-center">
                Aksi
              </th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <tr *ngFor="let employee of employees; trackBy: trackByEmployeeId; index as i" class="hover:bg-gray-50">
              <td class="px-6 py-2 whitespace-nowrap text-sm text-gray-900">
                {{ (pagination.currentPage - 1) * pagination.pageSize + i + 1 }}.
              </td>
              <td class="px-0 py-4 whitespace-nowrap">
                <div class="flex items-center">
                  <div class="flex-shrink-0 h-10 w-10">
                    <div class="h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center">
                      <span class="text-sm font-medium text-gray-700">
                        {{ employee.firstName.charAt(0)
                        }}{{ employee.lastName.charAt(0) }}
                      </span>
                    </div>
                  </div>
                  <div class="ml-4">
                    <div class="text-sm font-medium text-gray-900">
                      {{ employee.firstName }} {{ employee.lastName }}
                    </div>
                    <div class="text-sm text-gray-500">
                      ID: {{ employee.id }}
                    </div>
                  </div>
                </div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                {{ employee.username }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                {{ employee.email }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                {{ employee.group }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <app-status-badge [status]="employee.status"></app-status-badge>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2 gap-1">
                <button (click)="viewEmployeeDetail(employee.id!)"
                  class="text-blue-600 hover:text-blue-900 hover:bg-gray-200 rounded-full px-1 transition-colors">
                  Detail
                </button>
                <button (click)="onEdit(employee)"
                  class="text-yellow-600 hover:text-yellow-900 hover:bg-gray-200 rounded-full px-1 transition-colors">
                  Edit
                </button>
                <button (click)="onDelete(employee)" [disabled]="isDeleting(employee.id)"
                  [class]="'text-red-600 hover:text-red-900 hover:bg-gray-200 rounded-full px-1 transition-colors ' + (isDeleting(employee.id) ? 'opacity-50 cursor-not-allowed' : '')">
                  <span *ngIf="!isDeleting(employee.id)">Delete</span>
                  <span *ngIf="isDeleting(employee.id)" class="flex items-center gap-1">
                    <app-icon name="spinner" class="animate-spin h-4 w-4 text-red-600" fill="currentColor"></app-icon>
                    Menghapus...
                  </span>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Empty State -->
      <div *ngIf="employees.length === 0" class="text-center py-12">
        <app-icon name="users-empty" class="mx-auto h-12 w-12 text-gray-400" fill="currentColor"></app-icon>
        <h3 class="mt-2 text-sm font-medium text-gray-900">
          Tidak ada karyawan
        </h3>
        <p class="mt-1 text-sm text-gray-500">
          Mulai dengan menambahkan karyawan baru.
        </p>
      </div>

      <!-- Pagination -->
      <div *ngIf="employees.length > 0"
        class="bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6">
        <div class="flex-1 flex justify-between sm:hidden">
          <button [disabled]="pagination.currentPage === 1" (click)="onPageChange(pagination.currentPage - 1)"
            class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
            Previous
          </button>
          <button [disabled]="pagination.currentPage === pagination.totalPages"
            (click)="onPageChange(pagination.currentPage + 1)"
            class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
            Next
          </button>
        </div>
        <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
          <div>
            <p class="text-sm text-gray-700">
              Menampilkan
              <span class="font-medium">{{
                (pagination.currentPage - 1) * pagination.pageSize + 1
                }}</span>
              sampai
              <span class="font-medium">{{
                Math.min(
                pagination.currentPage * pagination.pageSize,
                pagination.totalItems
                )
                }}</span>
              dari
              <span class="font-medium">{{ pagination.totalItems }}</span>
              hasil
            </p>
          </div>
          <div>
            <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
              <button [disabled]="pagination.currentPage === 1" (click)="onPageChange(pagination.currentPage - 1)"
                class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
                <span class="sr-only">Previous</span>
                <app-icon name="chevron-left" class="h-5 w-5" fill="currentColor"></app-icon>
              </button>
              <button *ngFor="let page of getPaginationPages()" (click)="onPageChange(page)" [class]="
                  'relative inline-flex items-center px-4 py-2 border text-sm font-medium ' +
                  (page === pagination.currentPage
                    ? 'z-10 bg-blue-50 border-blue-500 text-blue-600'
                    : 'bg-white border-gray-300 text-gray-500 hover:bg-gray-50')
                ">
                {{ page }}
              </button>
              <button [disabled]="pagination.currentPage === pagination.totalPages"
                (click)="onPageChange(pagination.currentPage + 1)"
                class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
                <span class="sr-only">Next</span>
                <app-icon name="chevron-right" class="h-5 w-5" fill="currentColor"></app-icon>
              </button>
            </nav>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
